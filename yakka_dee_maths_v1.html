<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yakka Dee Math Time!</title>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background-image: url('./yakke_dee_figure1.jpg'), url('./yakke_dee_figure2.jpg'), radial-gradient(circle at 30% 20%, #ffe4f2 0%, #f9d3ff 35%, #c7f5ff 100%);
            background-size: 40%, 40%, cover;
            background-position: left 5% bottom 8%, right 6% bottom 10%, center;
            background-repeat: no-repeat;
            text-align: center;
            margin: 0;
            padding: 20px;
            user-select: none;
        }
        h1 { color: #ff4d6d; text-shadow: 2px 2px #ffd166; }
        
        /* ËøõÂ∫¶Êù°ÊòüÊòü */
        #stars { font-size: 0; margin-bottom: 20px; }
        #stars span { display:inline-block; width:52px; height:52px; margin:0 6px; background-image:url('./yakke_dee_figure3.jpg'); background-size: contain; background-repeat:no-repeat; filter: grayscale(100%) opacity(0.35); }
        .star-on { filter: none !important; }
        .star-off { filter: grayscale(100%) opacity(0.35) !important; }

        /* È¢òÁõÆÂå∫Âüü */
        #question-box {
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 32px;
            margin: 10px auto;
            max-width: 600px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.12);
        }
        #visual-aid {
            font-size: 50px;
            letter-spacing: 5px;
            margin-bottom: 10px;
        }
        #equation {
            font-size: 64px;
            color: #333;
            font-weight: bold;
        }

        /* Á≠îÊ°àÊåâÈíÆÂå∫ */
        #answers {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .btn {
            background-color: #4ecdc4;
            color: white;
            border: none;
            border-radius: 50%;
            width: 90px;
            height: 90px;
            font-size: 34px;
            cursor: pointer;
            box-shadow: 0 6px #2a9d8f;
            transition: transform 0.12s;
        }
        .btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        /* ËßÜÈ¢ëÂå∫Âüü */
        #video-container {
            display: none;
            margin-top: 20px;
        }
        iframe {
            width: 100%;
            max-width: 700px;
            aspect-ratio: 16/9;
            height: auto;
            border-radius: 18px;
        }
        #next-round-btn {
            display: none;
            margin-top: 20px;
            background-color: #ff9f43;
            width: 220px;
            border-radius: 50px;
        }

        #tick {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: rgba(0,200,83,0.9);
            color: #fff;
            font-size: 100px;
            line-height: 160px;
            display: none;
            box-shadow: 0 12px 24px rgba(0,0,0,0.2);
        }
        #gentle-msg {
            margin-top: 12px;
            color: #6c63ff;
            font-size: 22px;
            min-height: 28px;
        }
        #topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 900px;
            margin: 0 auto 10px auto;
        }
        #gift-btn {
            background: #ffda6c;
            color: #8a2be2;
            border: none;
            border-radius: 18px;
            padding: 8px 14px;
            font-size: 16px;
            box-shadow: 0 4px #e7b74f;
            opacity: 0.6;
        }
        #gift-btn.enabled { opacity: 1; animation: pulse 1.2s infinite; }
        @keyframes pulse { 0%{transform: scale(1);} 50%{transform: scale(1.06);} 100%{transform: scale(1);} }
        #start-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #start-card {
            background: #ffffff;
            border-radius: 24px;
            padding: 24px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 12px 24px rgba(0,0,0,0.2);
        }
        .chip-group { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }
        .chip {
            background: #e8f9fd;
            border: 2px solid #90e0ef;
            color: #0077b6;
            border-radius: 24px;
            padding: 10px 16px;
            font-size: 18px;
            cursor: pointer;
        }
        .chip.active { background: #ffd166; color: #7c2ae8; border-color: #ffbe0b; }
        #parent-btn {
            background: #f15bb5;
            color: #fff;
            border: none;
            border-radius: 18px;
            padding: 8px 14px;
            font-size: 16px;
            box-shadow: 0 4px #d0489f;
        }
        #share-btn {
            background: #70e000;
            color: #063970;
            border: none;
            border-radius: 18px;
            padding: 8px 14px;
            font-size: 16px;
            box-shadow: 0 4px #4cc100;
        }

        #cards { display: grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:16px; }

        @media (max-width: 480px) {
            body { background-size: 32%, 32%, cover; background-position: left 2% bottom 4%, right 3% bottom 6%, center; padding: 16px; }
            #question-box { max-width: 92vw; padding: 20px; }
            #visual-aid { font-size: 36px; letter-spacing: 2px; }
            #equation { font-size: 44px; }
            .btn { width: 72px; height: 72px; font-size: 26px; box-shadow: 0 5px #2a9d8f; }
            #stars span { width: 36px; height: 36px; margin: 0 4px; }
            iframe { max-width: 100%; border-radius: 14px; }
            #cards { grid-template-columns: repeat(auto-fill,minmax(160px,1fr)) !important; }
        }

        @media (min-width: 481px) and (max-width: 820px) {
            body { background-size: 34%, 34%, cover; background-position: left 3% bottom 6%, right 4% bottom 8%, center; }
            #question-box { max-width: 640px; padding: 26px; }
            #visual-aid { font-size: 44px; }
            #equation { font-size: 56px; }
            .btn { width: 80px; height: 80px; font-size: 30px; }
            #stars span { width: 44px; height: 44px; }
            iframe { max-width: 660px; border-radius: 16px; }
            #cards { grid-template-columns: repeat(auto-fill,minmax(200px,1fr)) !important; }
        }
    </style>
</head>
<body>

    <div id="topbar">
        <h1>‚≠ê Yakka Dee Â≠¶Êï∞Â≠¶ ‚≠ê</h1>
        <div>
            <button id="gift-btn">üéÅ Â•ñÂä± 0</button>
            <button id="parent-btn">ÂÆ∂ÈïøÂ•ñÂä±</button>
            <button id="share-btn">ÂàÜ‰∫´ÈìæÊé•</button>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÂå∫Âüü -->
    <div id="game-area">
        <div id="stars">
            <span id="s1" class="star-off"></span>
            <span id="s2" class="star-off"></span>
            <span id="s3" class="star-off"></span>
            <span id="s4" class="star-off"></span>
            <span id="s5" class="star-off"></span>
        </div>

        <div id="question-box">
            <div id="visual-aid">üçéüçé + üçé</div> <!-- ËßÜËßâËæÖÂä© -->
            <div id="equation">2 + 1 = ?</div>
            <div id="gentle-msg"></div>
        </div>

        <div id="answers">
            <!-- ÊåâÈíÆÁî±JSÁîüÊàê -->
        </div>
    </div>

    <!-- Â•ñÂä±Âå∫Âüü -->
    <div id="video-container">
        <h2 style="color: purple">ÂÅöÂæóÂ•ΩÔºÅÊù•Áúã Yakka Dee ÂêßÔºÅ</h2>
        <iframe id="video-player" src="" title="video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        <br>
        <button class="btn" id="next-round-btn" onclick="resetGame()">ÁªßÁª≠Â≠¶‰π†</button>
    </div>

    <div id="tick">‚úì</div>

    <div id="video-gallery" style="display:none; max-width: 960px; margin: 0 auto;">
        <h2 style="color:#7c2ae8">ÈÄâÊã©‰∏ÄÈõÜ Yakka Dee</h2>
        <div id="cards" style="display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:16px;"></div>
    </div>

    <div id="start-modal">
        <div id="start-card">
            <h2>ÈÄâÊã©ÁªÉ‰π†</h2>
            <div class="chip-group" id="op-group">
                <div class="chip" data-op="add">Âä†Ê≥ï</div>
                <div class="chip" data-op="sub">ÂáèÊ≥ï</div>
                <div class="chip" data-op="mul">‰πòÊ≥ï</div>
                <div class="chip" data-op="div">Èô§Ê≥ï</div>
                <div class="chip active" data-op="mix">Ê∑∑Âêà</div>
            </div>
            <h2>ÈÄâÊã©ÈöæÂ∫¶</h2>
            <div class="chip-group" id="diff-group">
                <div class="chip active" data-diff="easy">Easy</div>
                <div class="chip" data-diff="hard">Hard</div>
            </div>
            <br>
            <button class="btn" id="start-btn" style="border-radius: 16px; width: 180px; height: 60px; font-size: 26px;">ÂºÄÂßã</button>
        </div>
    </div>

    <audio id="opening-audio" src="./yakka_dee_opening.mp4" preload="auto"></audio>
    <audio id="ending-audio" src="./yakka_kee_ending.mp4" preload="auto"></audio>
    <audio id="correct-audio" src="./yeah yakka dee.m4a" preload="auto"></audio>
    <audio id="wrong-audio" src="./try again.m4a" preload="auto"></audio>

    <script>
        const targetWins = 5;
        const EPISODE_MS = 360000;
        const parentPassword = "DEE123";
        const seasons = [
            { title: 'Á¨¨‰∏ÄÂ≠£', bvid: 'BV1EX4qzdES5', episodes: 20 },
            { title: 'Á¨¨‰∫åÂ≠£', bvid: 'BV1WfyVBxEbo', episodes: 20 },
            { title: 'Á¨¨‰∏âÂ≠£', bvid: 'BV1tppBzhEz5', episodes: 20 },
            { title: 'Á¨¨ÂõõÂ≠£', bvid: 'BV1WFhzzyEsd', episodes: 20 },
            { title: 'Á¨¨‰∫îÂ≠£', bvid: 'BV1YDvAzBELi', episodes: 20 },
        ];
        let streak = 0;
        let currentCorrectAnswer = 0;
        let opMode = 'mix';
        let difficulty = 'easy';
        let bonusVideos = 0;
        let episodeTimer = null;
        let watchCounts = JSON.parse(localStorage.getItem('yak_dee_watch') || '{}');

        window.onload = function() {
            setupStartModal();
            setupParentControls();
            setupShare();
            document.getElementById('game-area').style.display = 'none';
        };

        function setupStartModal() {
            document.querySelectorAll('#op-group .chip').forEach(c => {
                c.onclick = () => {
                    document.querySelectorAll('#op-group .chip').forEach(x => x.classList.remove('active'));
                    c.classList.add('active');
                    opMode = c.getAttribute('data-op');
                };
            });
            document.querySelectorAll('#diff-group .chip').forEach(c => {
                c.onclick = () => {
                    document.querySelectorAll('#diff-group .chip').forEach(x => x.classList.remove('active'));
                    c.classList.add('active');
                    difficulty = c.getAttribute('data-diff');
                };
            });
            document.getElementById('start-btn').onclick = () => {
                document.getElementById('start-modal').style.display = 'none';
                document.getElementById('game-area').style.display = 'block';
                const opening = document.getElementById('opening-audio');
                opening.volume = 1;
                opening.currentTime = 0;
                opening.play().catch(()=>{});
                resetGame();
            };
        }

        function setupParentControls() {
            const giftBtn = document.getElementById('gift-btn');
            const parentBtn = document.getElementById('parent-btn');
            function refreshGift() {
                giftBtn.textContent = `üéÅ Â•ñÂä± ${bonusVideos}`;
                if (bonusVideos > 0) giftBtn.classList.add('enabled'); else giftBtn.classList.remove('enabled');
            }
            giftBtn.onclick = () => { if (bonusVideos > 0) { bonusVideos--; refreshGift(); showReward('gift'); } };
            parentBtn.onclick = () => {
                const pwd = prompt('ËØ∑ËæìÂÖ•ÂÆ∂ÈïøÂØÜÁ†Å');
                if (pwd === parentPassword) { bonusVideos++; refreshGift(); alert('Â∑≤Ëµ†ÈÄÅ 1 Ê¨°ËßÜÈ¢ëÂ•ñÂä±'); }
                else { alert('ÂØÜÁ†Å‰∏çÊ≠£Á°Æ'); }
            };
            refreshGift();
        }

        function setupShare() {
            const shareBtn = document.getElementById('share-btn');
            const url = 'https://codingzed.github.io/yakka_dee_maths_learning/';
            shareBtn.onclick = async () => {
                try {
                    if (navigator.share) {
                        await navigator.share({ title: 'Yakka Dee Maths', url });
                    } else {
                        await navigator.clipboard.writeText(url);
                        alert('ÈìæÊé•Â∑≤Â§çÂà∂');
                    }
                } catch (e) {
                    try { await navigator.clipboard.writeText(url); alert('ÈìæÊé•Â∑≤Â§çÂà∂'); } catch(_) {}
                }
            };
        }

        function nextQuestion() {
            setTimeout(generateQuestion, 600);
        }

        function generateQuestion() {
            let op = opMode === 'mix' ? ['add','sub','mul','div'][Math.floor(Math.random()*4)] : opMode;
            let n1 = 0, n2 = 0, answer = 0;
            if (op === 'add') {
                const maxA = difficulty === 'easy' ? 5 : 10;
                n1 = Math.floor(Math.random() * (maxA+1));
                n2 = Math.floor(Math.random() * (maxA - n1 + 1));
                answer = n1 + n2;
                document.getElementById('equation').innerText = `${n1} + ${n2} = ?`;
                document.getElementById('visual-aid').innerText = 'üçé'.repeat(n1) + ' ‚ûï ' + 'üçé'.repeat(n2);
            } else if (op === 'sub') {
                const maxS = difficulty === 'easy' ? 6 : 10;
                n1 = Math.floor(Math.random() * (maxS+1));
                n2 = Math.floor(Math.random() * (n1+1));
                answer = n1 - n2;
                document.getElementById('equation').innerText = `${n1} - ${n2} = ?`;
                document.getElementById('visual-aid').innerText = 'üçé'.repeat(n1) + ' ‚ûñ ' + 'üçé'.repeat(n2);
            } else if (op === 'mul') {
                const maxM = difficulty === 'easy' ? 5 : 10;
                n1 = Math.floor(Math.random() * (maxM+1));
                n2 = Math.floor(Math.random() * (maxM+1));
                answer = n1 * n2;
                document.getElementById('equation').innerText = `${n1} √ó ${n2} = ?`;
                document.getElementById('visual-aid').innerText = '‚≠ê'.repeat(n1) + ' ‚úñÔ∏è ' + '‚≠ê'.repeat(n2);
            } else {
                const maxD = difficulty === 'easy' ? 5 : 10;
                n2 = Math.max(1, Math.floor(Math.random() * (maxD+1)));
                n1 = n2 * Math.floor(Math.random() * (difficulty === 'easy' ? 5 : 10));
                answer = n1 / n2;
                document.getElementById('equation').innerText = `${n1} √∑ ${n2} = ?`;
                document.getElementById('visual-aid').innerText = 'üß©'.repeat(n1) + ' ‚ûó ' + 'üß©'.repeat(n2);
            }
            currentCorrectAnswer = answer;
            generateButtons(answer);
            document.getElementById('gentle-msg').innerText = '';
        }

        function generateButtons(correct) {
            const answersContainer = document.getElementById('answers');
            answersContainer.innerHTML = '';
            let wrong1 = correct + Math.floor(Math.random() * 3) + 1;
            let wrong2 = Math.max(0, correct - Math.floor(Math.random() * 3) - 1);
            let options = [correct, wrong1, wrong2];
            options = [...new Set(options)];
            while(options.length < 3) options.push(options[options.length-1] + 1);
            options.sort(() => Math.random() - 0.5);
            options.forEach(num => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = num;
                btn.onclick = () => checkAnswer(num);
                answersContainer.appendChild(btn);
            });
        }

        function playAudio(id) {
            const a = document.getElementById(id);
            if (!a) return;
            a.volume = 1;
            a.currentTime = 0;
            a.play().catch(()=>{});
        }

        function checkAnswer(selected) {
            if (selected === currentCorrectAnswer) {
                streak++;
                updateStars();
                document.getElementById('tick').style.display = 'block';
                playAudio('correct-audio');
                setTimeout(() => { document.getElementById('tick').style.display = 'none'; }, 600);
                if (streak >= targetWins) {
                    showReward('streak');
                } else {
                    nextQuestion();
                }
            } else {
                playAudio('wrong-audio');
                document.getElementById('gentle-msg').innerText = 'Oh no, try again';
                streak = 0;
                updateStars();
                nextQuestion();
            }
        }

        function updateStars() {
            for(let i=1; i<=5; i++) {
                const star = document.getElementById('s' + i);
                star.className = i <= streak ? 'star-on' : 'star-off';
            }
        }

        function showReward(source) {
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('video-container').style.display = 'none';
            const ending = document.getElementById('ending-audio');
            ending.volume = 1;
            ending.currentTime = 0;
            ending.play().catch(()=>{});
            setTimeout(() => {
                document.getElementById('video-gallery').style.display = 'block';
                document.getElementById('next-round-btn').style.display = 'inline-block';
                buildGallery();
            }, 300);
            if (episodeTimer) clearTimeout(episodeTimer);
            episodeTimer = setTimeout(() => { resetGame(); }, EPISODE_MS);
        }

        function buildGallery() {
            const cards = document.getElementById('cards');
            cards.innerHTML = '';
            seasons.forEach((s, si) => {
                for (let p = 1; p <= s.episodes; p++) {
                    const url = `https://player.bilibili.com/player.html?bvid=${s.bvid}&p=${p}&autoplay=1`;
                    const key = `${s.bvid}-p${p}`;
                    const count = watchCounts[key] || 0;
                    const label = count === 0 ? 'Êú™ËßÇÁúã' : `ËßÇÁúãËøá${count}Ê¨°`;
                    const card = document.createElement('div');
                    card.style.background = '#fff';
                    card.style.borderRadius = '16px';
                    card.style.padding = '12px';
                    card.style.boxShadow = '0 8px 16px rgba(0,0,0,0.12)';
                    card.style.cursor = 'pointer';
                    card.innerHTML = `<div style="font-weight:bold;color:#7c2ae8">${s.title} Á¨¨${p}ÈõÜ</div><div style="color:#555;margin-top:6px">${label}</div>`;
                    card.onclick = () => playVideo(url, key);
                    cards.appendChild(card);
                }
            });
        }

        function playVideo(url, key) {
            document.getElementById('video-gallery').style.display = 'none';
            document.getElementById('video-container').style.display = 'block';
            document.getElementById('video-player').src = url;
            watchCounts[key] = (watchCounts[key] || 0) + 1;
            localStorage.setItem('yak_dee_watch', JSON.stringify(watchCounts));
        }

        function resetGame() {
            streak = 0;
            updateStars();
            document.getElementById('video-player').src = '';
            document.getElementById('video-container').style.display = 'none';
            document.getElementById('video-gallery').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            if (episodeTimer) { clearTimeout(episodeTimer); episodeTimer = null; }
            generateQuestion();
        }
    </script>
</body>
</html>
